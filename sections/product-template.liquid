{% include 'wh_calculate_discount' with product, hide_method: 'break' %}
{% comment %}

Rich snippets (itemscope, itemtype, etc.) for products are a theme requirement,
and allow search engines to easily understand what the content is.

For more information on these Scheme.org tags, visit:
- http://schema.org/docs/gs.html

{% endcomment %}

{% include "attribute-product-image-box-ratio-max" %}

{% assign current_variant = product.selected_or_first_available_variant %}
{% include 'wh_variant' with current_variant %}

{% assign on_sale = false %}

{% if wh_v_compare_at_price > wh_v_price %}
	{% unless hide_on_sale_badge %}
		{% assign on_sale = true %}
	{% endunless %}
{% endif %}

{% assign in_stock = false %}
{% for variant in product.variants %}
	{% if variant.available %}
		{% assign in_stock = true %}
	{% endif %}
{% endfor %}

{% assign spice = '' %}

{% for tag in product.tags %}
	{% if tag contains "spice_" %}
		{% assign spice = tag | remove: "spice_" %}
	{% endif %}
{% endfor %}

<style>
.product-content.margins, .product-content.margins *{
  margin: 0 !important;
  padding: 0 !important;
}
hr.margins{
  display: none;
}
@media screen and (max-width: 699px){
  .product-content.margins *{
    width: 100% !important;
  }
}
</style>

<div
	data-product-container
	itemscope
	itemtype="http://schema.org/Product"
	{% if current_variant.image %}
	data-initial-image-position="{{ current_variant.image.position | json | minus: 1 }}"
	{% endif %}
	data-shop-default-currency="{{ shop.currency }}"
	data-product-options-size="{{ product.options.size }}"
	data-product-options-first="{{ product.options.first }}"
	data-product-variants-size="{{ product.variants.size }}"
	data-product-variants-first="{{ product.variants.first.title }}">

<script data-product-json type="application/json">
{% include 'wh_product_json' with product %}
</script>

<meta itemprop="url" content="{{ shop.url }}{{ product.url }}">
<meta itemprop="image" content="{{ product.featured_image.src | img_url: 'grande' }}">

{% include 'product-buy-panel'%}

<div class="product-content">
  <hr class="grid__item {% if section.settings.margins %}margins{% endif %}">


  {% if product.metafields.custom_fields["show_harvest_notes_and_size_gu"] == 1 %}
  <!-- MOBILE -->
  <section class="product-tabs large--hide" {{ block.shopify_attributes }}>

    <ul class="product-tab-wrapper">
      <li class="product-tab {% if section.settings.expand_first_tab %}active{% endif %}" data-product-tab data-name="story">
        <button class="product-tab-title organic-background" data-product-tab-title>
            <img  src="{{'tab-bg.png' | asset_img_url: 'master' }}" alt="">
          <div>Story</div>
        </button>
        <div class="product-description rte product-tab-content" data-name="story" data-product-tab-content>
          <div data-product-tab-content-inner>
            {{product.description}}
						<br>
          </div>
          <!-- <img class="little-wave" src="{{ 'medium-wave-pink.png' | asset_img_url: 'master' }}"> -->
          {% if product.metafields.custom_fields["product_description_image"] != blank %}
          <div class="full-width-image">
            {{ product.metafields.custom_fields["product_description_image"] }}
          </div>
          {% endif %}
        </div>
      </li>

	{% if product.metafields.custom_fields["spice_guide"] != blank or product.metafields.custom_fields["size_guide"] != blank %}
      <li class="product-tab " data-product-tab data-name="size-guide">
        <button class="product-tab-title organic-background" data-product-tab-title  id="size-guide">
            <img  src="{{'tab-bg.png' | asset_img_url: 'master' }}" alt="">
          <div>Size Guide</div>
        </button>
        <div class="size-chart charts wrapper rte product-tab-content" data-name="size-guide" data-product-tab-content>
          <div data-product-tab-content-inner>
            {% include 'size-chart' %}
          </div>
        </div>
      </li>
	{% endif %}

      <li class="product-tab" data-product-tab data-name="harvest">

        <button class="product-tab-title organic-background" data-product-tab-title>
              <img  src="{{'tab-bg.png' | asset_img_url: 'master' }}" alt="">
          <div>Harvest</div>
        </button>
        <div class="harvest rte product-tab-content" data-name="harvest" data-product-tab-content>
          <div data-product-tab-content-inner>
            <ul class="harvest-items">
              {% if product.metafields.custom_fields["origin"] != blank %}
              <li>
                <div class="custom-field--value">
                  {{ product.metafields.custom_fields["origin"] }}
                </div>
                <img src="{{ 'line-wavy-origin.png' | asset_img_url: 'master' }}">
                <div class="sub-text">Origin</div>
              </li>
              {% endif %}

              {% if product.metafields.custom_fields["harvest_year"] != blank %}
              <li>
                <div class="custom-field--value">
                  {{ product.metafields.custom_fields["harvest_year"] }}
                </div>
                <img src="{{ 'line-wavy-origin.png' | asset_img_url: 'master' }}">
                <div class="sub-text">Harvest Year</div>
              </li>
              {% endif %}

              {% if product.metafields.custom_fields["heirloom_seed_variety"] != blank %}
              <li>
                <div class="custom-field--value">
                  {{ product.metafields.custom_fields["heirloom_seed_variety"] }}
                </div>
                <img src="{{ 'line-wavy-origin.png' | asset_img_url: 'master' }}">
                <div class="sub-text">Heirloom seed variety
                  <br>
                  {% if product.metafields.custom_fields["seed_licensing"] != blank %}
                  {{ product.metafields.custom_fields["seed_licensing"] }}
                  {% endif %}
                </div>
              </li>
              {% endif %}
            </ul>
          </div>
          {% if product.metafields.custom_fields["harvest_image"] != blank %}
          <div class="harvest-image">
            <div class="custom-field custom-field__harvest-image custom-field__type--image">
              {{ product.metafields.custom_fields["harvest_image"] }}
            </div>
          </div>
          {% endif %}
        </div>
      </li>
    </ul>

    {% if product.metafields.custom_fields["product_quote"] != blank %}
    <figure class="product-single__quote product-single__photos">
      {{ product.metafields.custom_fields["product_quote"] }}
    </figure>
    {% endif %}

  </section>

  <!-- DESKTOP -->
  <section class="medium-down--hide" >
    <div class="product-desc-harvest wrapper">
      <div class="product-description" >
        <div >
          {{product.description}}
        </div>
      </div>
      <div class="harvest will-animate fade-in">
        <ul class="harvest-items">
          {% if product.metafields.custom_fields["origin"] != blank %}
          <li>
            <div class="custom-field--value">
              {{ product.metafields.custom_fields["origin"] }}
            </div>
            <img src="{{ 'line-wavy-origin.png' | asset_img_url: 'master' }}">
            <div class="sub-text">Origin</div>
          </li>
          {% endif %}

          {% if product.metafields.custom_fields["harvest_year"] != blank %}
          <li>
            <div class="custom-field--value">
              {{ product.metafields.custom_fields["harvest_year"] }}
            </div>
            <img src="{{ 'line-wavy-origin.png' | asset_img_url: 'master' }}">
            <div class="sub-text">Harvest Year</div>
          </li>
          {% endif %}

          {% if product.metafields.custom_fields["heirloom_seed_variety"] != blank %}
          <li>
            <div class="custom-field--value">
              {{ product.metafields.custom_fields["heirloom_seed_variety"] }}
            </div>
            <img src="{{ 'line-wavy-origin.png' | asset_img_url: 'master' }}">
            <div class="sub-text">Heirloom seed variety
              <br>
              {% if product.metafields.custom_fields["seed_licensing"] != blank %}
              {{ product.metafields.custom_fields["seed_licensing"] }}
              {% endif %}
            </div>
          </li>
          {% endif %}
        </ul>
        {% if product.metafields.custom_fields["harvest_image"] != blank %}
        <div class="harvest-image">
          <div class="custom-field custom-field__harvest-image custom-field__type--image">
            {{ product.metafields.custom_fields["harvest_image"] }}
          </div>
        </div>
        {% endif %}
      </div>
    </div>


    {% if product.metafields.custom_fields["product_quote"] != blank %}
    <figure class="product-single__quote product-single__photos">
          {{ product.metafields.custom_fields["product_quote"] }}
    </figure>
    {% endif %}

    {% if product.metafields.custom_fields["product_description_image"] != blank %}
    <div class="full-width-image  background-illustration">
      {{ product.metafields.custom_fields["product_description_image"] }}
    </div>
    {% endif %}

		{% if product.metafields.custom_fields["spice_guide"] != blank or product.metafields.custom_fields["size_guide"] != blank %}
	    <div class="size-chart charts wrapper" id="size-chart">
	      {% include 'size-chart' %}
	    </div>
		{% endif %}

  </section>

  {% if product.metafields.custom_fields["equity_pledge_image"] != blank %}
  <div class="background-illustration equity_pledge_illustrations">
  <div class="equity-pledge ">
    <div class="wrapper charts">
      <div class="chart-header will-animate fade-in ">
        <h2> Our Equity Pledge </h2>
        <div class="custom-field--value">
          {{ product.metafields.custom_fields["spice_card_details"] }}
        </div>
      </div>
      <div class="custom-field custom-field__equity-pledge-image custom-field__type--image">
        {{ product.metafields.custom_fields["equity_pledge_image"] }}
      </div>
    </div>
  </div>
  </div>
  {% endif %}

  {% else %}
  <div class="product-description rte only-description" id="description" itemprop="story">
    {{product.description}}
  </div>
  {% endif %}

  {% if product.metafields.custom_fields["banner_text"] != blank %}
  <div class="product__testing-results">
    <div>
      {{ product.metafields.custom_fields["banner_text"] }}
    </div>
    <a href=" {{ product.metafields.custom_fields["testing_results_link"] }}" target="_blank" class="btn"> {{ product.metafields.custom_fields["banner_button_text"] }}</a>
  </div>
  {% endif %}

</div>

{% if section.settings.product_reviews %}
<div id="shopify-product-reviews"  data-id="{{ product.id }}">{{ product.metafields.spr.reviews }}</div>
{% endif %}

{% include 'recipes-and-related' %}

</div>

<script>
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
  anchor.addEventListener('click', function (e) {
    e.preventDefault();

    document.querySelector(this.getAttribute('href')).scrollIntoView({
      behavior: 'smooth'
    });
  });
});
</script>


  {% comment %}
  To take advantage of a callback on the select dropdown, add option_selection.js
  and customize the JS in timber.productPage as needed.

  Currently, timber.productPage does the following:
  - Hides your <select> tag from above
  - Breaks out the product variants into separate product options, if more than one exists
  - Generates a <select> tag for each product option
  - Enables/disables elements based on variant availability

  Callback notes:
  - Keep the callback available to the global scope (window.selectCallback) so that advanced
  addons can override it.
  * E.g. multiple currencies http://docs.shopify.com/manual/configuration/store-customization/currencies-and-translations/currencies/how-to-toggle-between-two-currencies
  {% endcomment %}

  {% schema %}
  {
    "name": "Product pages",
    "class": "product-pages",
    "settings": [
    {
      "type": "color",
      "id": "product-image-background",
      "label": "Image background color",
      "default": "#F9F9F9"
    },
    {
      "type": "checkbox",
      "id": "margins",
      "label": "Show margins around Custom Fields",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "product_related",
      "label": "Show related products"
    },
    {
      "type": "checkbox",
      "id": "product_recipies",
      "label": "Show related recipies"
    },
    {
      "type": "checkbox",
      "id": "product_reviews",
      "label": "Show product reviews",
      "info": "The [Shopify product reviews app](https://apps.shopify.com/product-reviews) must be installed"
    },
    {
      "type": "checkbox",
      "id": "enable_payment_button",
      "label": "Show dynamic checkout button",
      "info": "Lets customers check out directly using a familiar payment method. [Learn more](https://help.shopify.com/manual/using-themes/change-the-layout/dynamic-checkout)",
      "default": true
    },
		{
			"type": "header",
			"content": "Secondary button",
			"info": "Floating 'sticky' button, leave all items blank to disable"
		},
		{
		  "type": "text",
		  "id": "circletext",
		  "label": "Secondary button semicircle-path text"
		},
		{
			"type": "text",
			"id": "bundler_link_text_pre",
			"label": "Secondary button pre-text"
		},
		{
		  "type": "text",
		  "id": "bundler_link_text",
		  "label": "Secondary button text"
		},
		{
			"type": "text",
			"id": "bundler_link_text_sub",
			"label": "Secondary button sub-text"
		},
		{
		  "type": "url",
		  "id": "bundler_link",
		  "label": "Secondary button link"
		},
		{
			"type": "header",
			"content": "Images"
		},
    {
      "type": "select",
      "id": "image_layout_style",
      "label": "Image layout style",
      "options": [
      {
        "value": "thumbnails",
        "label": "Thumbnails"
      },
      {
        "value": "stacked_images",
        "label": "Stacked images"
      },
      {
        "value": "stacked_images_sticky_sidebar",
        "label": "Stacked images with sticky sidebar"
      }
      ],
      "default": "thumbnails"
    },
    {
      "type": "checkbox",
      "id": "expand_first_tab",
      "label": "Expand first tab when sidebar is sticky"
    },
    {
      "type": "checkbox",
      "id": "divider",
      "label": "Add divider below product section"
    }
    ],
    "blocks": [
    {
      "type": "tab",
      "name": "Tab",
      "settings": [
      {
        "type": "page",
        "id": "product_tab_page",
        "label": "Select page as tab content"
      }
      ]
    },
    {
      "type": "share",
      "name": "Share buttons",
      "limit": 1,
      "settings": [
      {
        "type": "checkbox",
        "id": "share_facebook",
        "label": "Facebook"
      },
      {
        "type": "checkbox",
        "id": "share_pinterest",
        "label": "Pinterest"
      },
      {
        "type": "checkbox",
        "id": "share_google",
        "label": "Google Plus"
      },
      {
        "type": "checkbox",
        "id": "share_twitter",
        "label": "Twitter"
      },
      {
        "type": "checkbox",
        "id": "share_tumblr",
        "label": "Tumblr"
      }
      ]
    }
    ]
  }
  {% endschema %}
